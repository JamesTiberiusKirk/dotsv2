#!/bin/bash

# i3 Config Documentation Generator
# Generates grep-friendly documentation from i3 config

CONFIG_FILE="${1:-$HOME/.config/i3/config}"
OUTPUT_FILE="${2:-$HOME/.config/i3/bindings.txt}"

if [[ ! -f "$CONFIG_FILE" ]]; then
    echo "Error: Config file not found: $CONFIG_FILE"
    exit 1
fi

# Extract the $mod value
MOD_KEY=$(grep -m1 '^set \$mod' "$CONFIG_FILE" | awk '{print $3}')
MOD_DISPLAY="Super"
[[ "$MOD_KEY" == "Mod1" ]] && MOD_DISPLAY="Alt"

# Extract all bindings, replace $mod, format and sort
grep '^bindsym' "$CONFIG_FILE" | \
    sed "s/\$mod/$MOD_DISPLAY/g" | \
    sed 's/bindsym[ \t]*//g' | \
    awk -F' ' '{printf "%-35s %s\n", $1, substr($0, index($0,$2))}' | \
    sed 's/split h$/split h (horizontal)/' | \
    sed 's/split v$/split v (vertical)/' | \
    sed 's/layout stacking$/layout stacking (stack windows)/' | \
    sed 's/layout tabbed$/layout tabbed (tabbed windows)/' | \
    sed 's/layout toggle split$/layout toggle split (toggle split layout)/' | \
    sed 's/floating toggle$/floating toggle (toggle floating\/tiling)/' | \
    sed 's/fullscreen toggle$/fullscreen toggle (toggle fullscreen)/' | \
    sed 's/focus mode_toggle$/focus mode_toggle (switch focus floating\/tiling)/' | \
    sed 's/focus parent$/focus parent (focus parent container)/' | \
    sed 's/focus left$/focus left (move focus left)/' | \
    sed 's/focus right$/focus right (move focus right)/' | \
    sed 's/focus up$/focus up (move focus up)/' | \
    sed 's/focus down$/focus down (move focus down)/' | \
    sort > "$OUTPUT_FILE"

echo "Documentation generated: $OUTPUT_FILE"
echo "Usage: grep 'layout' $OUTPUT_FILE"
